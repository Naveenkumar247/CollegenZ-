<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post | Collegenz</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f8f9fa;
        padding: 20px;
      }
      .card {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 15px;
        max-width: 700px;
        margin: 40px auto;
        background: #fff;
        padding: 20px;
      }
      .carousel img {
        border-radius: 10px;
      }
      .bi {
        font-size: 1.4rem;
      }
    </style>
  </head>

  <body>
    <div class="card text-center">
      <h5 id="userEmail">Loading...</h5>
      <div id="carouselContainer" class="my-3"></div>
      <p id="postData"></p>

      <div class="mt-3 d-flex justify-content-center align-items-center gap-4">
        <button class="btn btn-link btn-sm" style="color: gray;">
          <i class="bi bi-heart"></i>
        </button>
        <span id="likeCount">0</span>

        <button class="btn btn-link btn-sm" style="color: gray;">
          <i class="bi bi-bookmark"></i>
        </button>
        <span id="saveCount">0</span>

        <button class="btn btn-link btn-sm" style="color: gray;">
          <i class="bi bi-share"></i>
        </button>
      </div>
    </div>

    <script>
      // Get postId from URL
      const postId = window.location.pathname.split("/").pop();

      // Fetch post data
      fetch(`/api/post/${postId}`)
        .then((res) => res.json())
        .then((post) => {
          if (post.error) {
            document.body.innerHTML = "<h3>Post not found</h3>";
            return;
          }

          document.getElementById("userEmail").textContent =
            post.userEmail || "Unknown User";
          document.getElementById("postData").textContent = post.data || "";
          document.getElementById("likeCount").textContent = post.likes || 0;
          document.getElementById("saveCount").textContent = post.saves || 0;

          const container = document.getElementById("carouselContainer");

          if (Array.isArray(post.imageurl) && post.imageurl.length > 1) {
            container.innerHTML = `
              <div id="carousel-${post._id}" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  ${post.imageurl
                    .map(
                      (img, i) => `
                      <div class="carousel-item ${i === 0 ? "active" : ""}">
                        <img src="${img}" class="d-block w-100">
                      </div>`
                    )
                    .join("")}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel-${
                  post._id
                }" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel-${
                  post._id
                }" data-bs-slide="next">
                  <span class="carousel-control-next-icon"></span>
                </button>
              </div>`;
          } else if (post.imageurl && post.imageurl.length > 0) {
            const img = Array.isArray(post.imageurl)
              ? post.imageurl[0]
              : post.imageurl;
            container.innerHTML = `<img src="${img}" class="img-fluid" style="border-radius:10px;">`;
          }
        })
        .catch((err) => {
          console.error(err);
          document.body.innerHTML = "<h3>Error loading post</h3>";
        });
    </script>
  </body>
</html>
