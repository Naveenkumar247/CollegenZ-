<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Post | Collegenz</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>

<style>

body{
  background:#f5f5f5;
  font-family:Arial, sans-serif;
}

.card{
  max-width:700px;
  margin:30px auto;
  border-radius:18px;
  border:none;
  box-shadow:0 4px 15px rgba(0,0,0,.1);
  padding:20px;
}

.postuser-info{
  display:flex;
  align-items:center;
  gap:12px;
}

.postprofile-pic{
  width:55px;
  height:55px;
  border-radius:50%;
  object-fit:cover;
}

.user-details p{
  margin:0;
  color:gray;
  font-size:.9rem;
}

.carousel img{
  border-radius:12px;
}

.action-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:12px;
}

.action-left{
  display:flex;
  gap:25px;
  align-items:center;
}

.action-btn{
  cursor:pointer;
  color:#444;
  display:flex;
  align-items:center;
  gap:6px;
}

.action-btn i{
  font-size:1.5rem;
}

.see-more{
  color:#0d6efd;
  cursor:pointer;
  font-weight:500;
  text-decoration:none;
}

.brand-box{
  margin-top:25px;
  text-align:center;
}

.join-btn{
  background:#228B22;
  color:white;
  border:none;
  padding:10px 25px;
  border-radius:8px;
  font-weight:600;
}

.join-btn:hover{
  background:#1b6f1b;
}

</style>
</head>

<body>

<div class="card text-center" id="postContainer">
<h5>Loading...</h5>
</div>

<script>

/* ================= GET POST ================= */

const postId = window.location.pathname.split("/").pop();

fetch(`/api/post/${postId}`)
.then(res=>res.json())
.then(p=>{

if(p.error){
document.body.innerHTML="<h3>Post not found</h3>";
return;
}

const container=document.getElementById("postContainer");

const images=Array.isArray(p.imageurl)?p.imageurl:[p.imageurl];

/* ================= CAROUSEL ================= */

let indicators="";
images.forEach((_,i)=>{
indicators+=`
<button type="button"
data-bs-target="#carousel-${p._id}"
data-bs-slide-to="${i}"
${i===0?"class='active'":""}></button>`;
});

let slides="";
images.forEach((img,i)=>{
slides+=`
<div class="carousel-item ${i===0?"active":""}">
<div class="position-relative">

<img src="${img}"
class="d-block w-100 img-fluid"
style="max-height:600px;object-fit:contain;background:#f8f9fa">

${images.length>1?`
<div class="position-absolute top-0 end-0 bg-dark text-white px-2 py-1 m-2 rounded small opacity-75">
${i+1}/${images.length}
</div>`:""}

</div>
</div>`;
});

const carouselHTML=`
<div id="carousel-${p._id}" class="carousel slide" data-bs-touch="true">

${images.length>1?`<div class="carousel-indicators">${indicators}</div>`:""}

<div class="carousel-inner">${slides}</div>

</div>
`;

/* ================= DESCRIPTION ================= */

const short=p.data?.slice(0,120)||"";
const rest=p.data?.slice(120)||"";

const captionHTML=`
<p id="caption-${p._id}">
${short}
${rest?`
<span id="dots-${p._id}">...</span>
<span id="more-${p._id}" style="display:none;">${rest}</span>
<a class="see-more" onclick="expandText('${p._id}')"> more</a>
`:""}
</p>
`;

/* ================= UI BUILD ================= */

container.innerHTML=`

<div class="postuser-info">
<img src="${p.picture||'/uploads/profilepic.jpg'}" class="postprofile-pic">

<div class="user-details text-start">
<strong>${p.username||p.userEmail}</strong>
<p>${p.college||""}</p>
</div>
</div>

<div class="my-3">${carouselHTML}</div>

<div class="action-bar">

<div class="action-left">

<div class="action-btn">
<i class="bi bi-heart"></i>
<span>${p.likes||0}</span>
</div>

<div class="action-btn">
<i class="bi bi-bookmark"></i>
<span>${p.saves||0}</span>
</div>

<div class="action-btn" onclick="sharePost('${p._id}')">
<i class="bi bi-share"></i>
<span>${p.shares||0}</span>
</div>

</div>

</div>

${captionHTML}

<div class="brand-box">

<h3>CollegenZ</h3>
<p>A new world for productive people</p>

<p style="color:#666;font-size:.9rem;">
For more information visit <strong>CollegenZ</strong>
</p>

<a href="https://collegenz.in" class="join-btn">
Join Now
</a>

</div>
`;

});

/* ================= SEE MORE ================= */

function expandText(id){
document.getElementById("dots-"+id).style.display="none";
document.getElementById("more-"+id).style.display="inline";
}

/* ================= SHARE ================= */

function sharePost(id){

const url=`https://collegenz.in/share/${id}`;

if(navigator.share){
navigator.share({
title:"CollegenZ Post",
text:"Check out this post on Collegenz ðŸŒ±",
url:url
});
}else{
window.open(
`https://wa.me/?text=${encodeURIComponent(url)}`,
"_blank"
);
}
}

</script>

</body>
</html>
